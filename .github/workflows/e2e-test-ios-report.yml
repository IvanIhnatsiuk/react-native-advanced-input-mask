name: 📝 Create E2E ios report comment

on:
  workflow_run:
    workflows: ["🛠 iOS e2e tests"]
    types: [completed]

permissions:
  pull-requests: write
  actions: read

jobs:
  comment:
    name: 💬 Post iOS E2E report
    runs-on: ubuntu-latest
    if: github.event.workflow_run.conclusion == 'success'
    steps:
      - name: Download size data
        uses: actions/download-artifact@v4
        with:
          name: e2e-report-ios
          github-token: ${{ secrets.GITHUB_TOKEN }}
          run-id: ${{ github.event.workflow_run.id }}

      - name: Parse JUnit XML and Format Report
        id: parse-report
        run: bash scripts/format-test-report.sh

      - name: Post Test Report as PR Comment
        if: github.event_name == 'pull_request'
        uses: peter-evans/create-or-update-comment@v4
        with:
          issue-number: ${{ github.event.pull_request.number }}
          body: |
            ## 📊 iOS Test Results

            | Test Name | Status | Time (s) |
            |-----------|--------|---------|
            $(cat test-report.md)
          edit-mode: replace
